# Credential Verification Web

## Running the project

We use [nvm](https://github.com/nvm-sh/nvm) to handle the node versions.

To ensure the node version standardized run `nvm use`, which will set the node version to 10.16.3, if installed, otherwise install it and then run the command again.

Prior to running the app install the dependencies with `npm install`.

Copy `.env` file to `.env.local` and configure environment variables.

Lastly, to run the project use `npm run start` or just `npm start`.

### Integration with grpc backends

First of all, ensure you have .protos compiled. For more information go to [Compile .protos section](#Compile-.protos)

Run envoy proxy. Envoy is just for dev environment
1. Edit `./envoy/envoy.yaml` setting your host ip in `clusters.hosts[socket_address.address]`. 
1. Go to ./envoy directory and run `docker build -t envoy:{versionTag} .`. 
1. Start envoy running `docker run -d --name {containerName} -p 9901:9901 -p 10000:10000 envoy:{versionTag}`

To run backend see [Run backend doc](../credentials-verification/docs/connector/README.md)
- Connector `mill connector.run`
- Wallet `mill wallet.run`

Configure envoy proxy "listening port" at .env.local file. For more information about environment variables see [Configurations](#Configurations)

## Compile .protos

All proto files (the .proto files and the ones generated by protoc) are in the proto dir, which is inside the src dir.

In order to compile the .protos you need to install
1. [protoc](https://github.com/protocolbuffers/protobuf/releases)
1. [grp-web](https://github.com/grpc/grpc-web/releases)

Then run

`protoc -I=. src/protos/* --js_out=import_style=commonjs:. --grpc-web_out=import_style=commonjs,mode=grpcwebtext:.`

## Configurations

react-scripts package use internally .dotenv. For more information see [adding-custom-environment-variables](https://create-react-app.dev/docs/adding-custom-environment-variables).

Environment variables are configured in `.env` file.
For development purposes copy `.env` file to `.env.local`. This file is excluded from git and overrides `.env`  for all environments except test.

### Docker build

1. Environment variables in `.env` config file are used as default.
1. Build deployment bundle with `npm run build`
1. Build docker image `docker build .`.
1. Run container `docker run -it -p 80:HOST_PORT -e REACT_APP_GRPC_CLIENT=http://localhost:10000 --rm <image>`.