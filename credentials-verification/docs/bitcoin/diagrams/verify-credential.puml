@startuml
title Bitcoin - Verify credential

actor Holder
participant IOHK
actor Verifier
participant "ATALA Node" as AtalaNode

Verifier -> IOHK : Ask for a connection code
IOHK -> IOHK : Verify verifier identity
IOHK -> IOHK : Verify verifier billing plan\n the verifier may need to pay\n or the holder may pay instead \n or it may be free
IOHK -> IOHK : Generate unique connection code
IOHK -> Verifier : Connection code generated

Verifier -> Holder : Share the connection code as a QR code
Holder -> Holder : Scan QR code
Holder -> IOHK : Get Verifier from connection code
IOHK -> Holder : Verifier details retrieved
Holder -> Holder : Validate whether a payment is required
Holder -> Holder : Add verifier connection\n attaching an optional proof of payment\n which depends on the previous details

Holder -> Holder : Generate private DID
Holder -> IOHK : Accept connection (verifier, DID)
IOHK -> Holder : Connection registered
IOHK -> Verifier : Holder connected

Holder -> IOHK : Share credential to the Verifier
IOHK -> Verifier : Share holder credential
Verifier -> IOHK : Ack
IOHK -> Holder : Credential shared

Verifier -> AtalaNode : Find issuer DID document
AtalaNode -> Verifier : Issuer DID
Verifier -> Verifier : Verify if the credential \nwas issued by the issuer
Verifier -> AtalaNode : Find issuer revocation registry
AtalaNode -> Verifier : Revocation registry
Verifier -> Verifier : Verify if the credential is revoked
Verifier -> Verifier : Verification verdict
@enduml
